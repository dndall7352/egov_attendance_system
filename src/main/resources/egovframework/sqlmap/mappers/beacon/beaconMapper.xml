<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="egovframework.atoz.main.beacon.service.impl.BeaconMapper">
	<select id="selectBeaconList" resultType="egovMap">
		<!-- select bc.beacon_number, bc.uuid, com.com_name, com.com_number, bc.major, bc.minor, bc.use, bc.note
		from beacon_info bc, company_info com, department_info dep
		where bc.dep_number = dep.dep_number
		and dep.com_number = com.com_number -->
		
		SELECT *
		 FROM (
			SELECT A.*, ROWNUM RNUM 
			FROM (
				SELECT
					bc.beacon_number, bc.uuid, com.com_name, com.com_number, bc.major, bc.minor, bc.use, bc.note
				FROM beacon_info bc, company_info com, department_info dep
				where
			<if test="searchName != null">
				<choose>
					<when test="searchType == 'uuid'">bc.uuid like '%' || #{searchName} || '%'</when>
					<when test="searchType == 'com_name'">com.com_name like '%' || #{searchName} || '%'</when>
					<when test="searchType == 'note'">bc.note like '%' || #{searchName} || '%'</when>
					<otherwise>
						(bc.uuid like '%' || #{searchName} || '%'
					or com.com_name like '%' || #{searchName} || '%'
					or bc.note like '%' || #{searchName} || '%')
					</otherwise>
				</choose>
			</if>
					
				and bc.dep_number = dep.dep_number
				and dep.com_number = com.com_number
				ORDER BY bc.beacon_number DESC
		
	<![CDATA[					
			) A 
		)WHERE RNUM between (#{pageNum} - 1) * #{amount} + 1 and #{pageNum} * #{amount}
		]]> 
	</select>
	
	<select id="selectBeaconListTotCnt" resultType="int">
		SELECT COUNT(*)
			FROM beacon_info bc, company_info com, department_info dep
			where
			<choose>
				<when test="searchType == 'uuid'">bc.uuid like '%' || #{searchName} || '%'</when>
				<when test="searchType == 'com_name'">com.com_name like '%' || #{searchName} || '%'</when>
				<when test="searchType == 'note'">bc.note like '%' || #{searchName} || '%'</when>
				<otherwise>
						(bc.uuid like '%' || #{searchName} || '%'
					or com.com_name like '%' || #{searchName} || '%'
					or bc.note like '%' || #{searchName} || '%')
					</otherwise>
			</choose>
			and bc.dep_number = dep.dep_number
			and dep.com_number = com.com_number
			<!-- <if test="searchKeyword != null and searchKeyword != ''">
				<if test="searchCondition == 0">AND
					COM_NUMBER = #{searchKeyword}
				</if>
				<if test="searchCondition == 1">AND
					COM_NAME LIKE '%' || #{searchKeyword} || '%'
				</if>
			</if> -->
	</select>
	
	<select id="selectBeacon" resultType="egovframework.atoz.main.beacon.service.BeaconDTO">
		SELECT
						bc.beacon_number, bc.uuid, com.com_name, com.com_number, bc.major, bc.minor, bc.use, bc.note
						FROM beacon_info bc, company_info com, department_info dep
				WHERE 1=1
				and bc.dep_number = dep.dep_number
				and dep.com_number = com.com_number
				and bc.beacon_number = #{beacon_number}
	</select>
</mapper>